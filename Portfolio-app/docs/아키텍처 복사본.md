

---

## 1) 전체 아키텍처(권장)

### 1.1 구성(서비스/컴포넌트)

- **Web/App API 서버**: Spring Boot (REST API, 인증, CRUD, 조회)
    
- **Worker(비동기/배치)**: Spring Boot(별도 모듈) + Job Queue
    
- **Pricing/FX 인제스트 서비스**: 시세/환율 수집(폴링/스케줄)
    
- **Valuation Engine**: 실시간 평가 캐시 계산 + 스냅샷 적재
    
- **Backtest Engine**: 백테스트 비동기 실행(큐 기반)
    
- **Cache/Message**: Redis + 메시지 큐(RabbitMQ 또는 Kafka)
    
- **DB**: PostgreSQL
    
- **프론트**: Vue 3 SPA (또는 SSR은 Nuxt로 확장)
    

> 초기엔 모놀리식(단일 Spring Boot) + worker만 분리해도 충분합니다. 백테스트/인제스트가 커지면 서비스 분리.

---

## 2) 백엔드 기술스택(Spring Boot / Java)

### 2.1 언어/런타임

- **Java 21 (LTS)** 권장
    
    - 이유: 성능/GC 개선, 최신 LTS
        
- 빌드: **Gradle**(권장) 또는 Maven
    

### 2.2 Spring 구성

- **Spring Boot 3.3+**(가능한 최신)
    
- 모듈:
    
    - `spring-boot-starter-web` (REST)
        
    - `spring-boot-starter-validation` (Bean Validation)
        
    - `spring-boot-starter-security` (JWT/권한)
        
    - `spring-boot-starter-data-jpa` (ORM)
        
    - `spring-boot-starter-actuator` (헬스/메트릭)
        
    - `spring-boot-starter-cache` (Redis Cache)
        
    - `spring-boot-starter-webflux` (선택: 시세/환율 호출이 많을 때 non-blocking HTTP client)
        

### 2.3 데이터 접근

- ORM: **Spring Data JPA + Hibernate**
    
- 고성능 조회/리포트(선택):
    
    - **jOOQ**(권장) 또는 QueryDSL
        
    - 이유: 성과/리스크/비교 쿼리는 집계가 많고 SQL 제어가 중요
        

### 2.4 API 설계/문서화

- REST + 표준 응답 포맷(Envelope)
    
- 문서:
    
    - **springdoc-openapi**(Swagger UI)
        
- 버전 관리: `/api/v1`
    

### 2.5 인증/보안

- 인증 방식:
    
    - **JWT Access + Refresh 토큰**(기본)
        
    - (확장) OAuth2 로그인(Apple/Google): `spring-security-oauth2-client`
        
- 권한 모델:
    
    - Workspace Role(OWNER/EDITOR/VIEWER) 기반
        
- 저장 보안:
    
    - 토큰/연동키: DB 암호화 + (운영) KMS 연동
        

### 2.6 비동기/배치/스케줄링

- **Spring Scheduler**: 간단 배치(가격 EOD 등)
    
- **Spring Batch**(선택): 대량 적재/리포트 생성
    
- 비동기 실행:
    
    - **RabbitMQ**(권장, 운영 난이도↓) 또는 **Kafka**(확장성↑)
        
    - Job 처리: 워커(별도 앱) + 큐 구독
        
- 분산락(중요):
    
    - **ShedLock + PostgreSQL** 또는 Redis 기반 락
        
    - 이유: 배치 중복 실행 방지
        

### 2.7 외부 호출/리트라이/서킷브레이커

- HTTP Client:
    
    - Spring WebClient(WebFlux) 또는 RestClient
        
- Resilience:
    
    - **Resilience4j**(Retry/RateLimiter/CircuitBreaker/Bulkhead)
        
- API Rate limit(보호):
    
    - 서버단: Bucket4j(선택)
        

### 2.8 로깅/관측

- Logging: **Logback + JSON 로그**
    
- Tracing/Metrics:
    
    - **Micrometer + Prometheus**
        
    - 분산추적: **OpenTelemetry**(선택)
        
- Error monitoring: Sentry(선택)
    

---

## 3) 데이터베이스(PostgreSQL) & 스키마 전략

### 3.1 PostgreSQL 버전/확장

- **PostgreSQL 16+** 권장
    
- 확장(선택):
    
    - **pg_trgm** (검색 성능: 종목명/티커)
        
    - **uuid-ossp** 또는 앱 레벨 UUID 생성
        
    - (시간시계열이 커지면) **TimescaleDB** 검토(2차)
        

### 3.2 데이터 모델링 핵심

- 거래 원장(Transactions + Legs) 중심
    
- 가격/환율 시계열: `price_bars`, `fx_rates`
    
- 스냅샷 캐시: `portfolio_valuation_snapshots`, `position_snapshots`
    

### 3.3 인덱스/파티셔닝(중요)

- 필수 인덱스:
    
    - `transactions(portfolio_id, occurred_at)`
        
    - `price_bars(instrument_id, ts)`
        
    - `fx_rates(base_currency, quote_currency, ts)`
        
- 시계열 테이블 파티셔닝(성장 대비):
    
    - `price_bars`는 월 단위 Range Partition 고려
        
- 정합성:
    
    - 금액/수량 decimal(고정소수) 사용
        
    - 통화코드/자산군 enum은 DB enum 또는 앱 enum + 체크제약
        

### 3.4 마이그레이션

- **Flyway**(권장) 또는 Liquibase
    
- 운영정책:
    
    - 모든 PR에 migration 포함
        
    - 롤백 스크립트/전방호환 고려
        

---

## 4) 캐시/세션/실시간(Redis)

### 4.1 Redis 구성

- **Redis 7+**
    
- 사용처:
    
    - 최신 시세 tick 캐시: `tick:{instrumentId}`
        
    - 최신 환율 캐시: `fx:{base}:{quote}`
        
    - 포트 평가 캐시: `val:{portfolioId}:realtime`
        
    - 백테스트 결과 요약 캐시(옵션)
        

### 4.2 TTL 정책(권장)

- tick: 60~180초
    
- fx: 300초
    
- valuation realtime: 10~30초
    
- valuation eod: 1~24시간
    

### 4.3 Pub/Sub(선택)

- 포트 평가 갱신 알림(프론트 폴링 감소):
    
    - Redis Pub/Sub 또는 WebSocket/STOMP
        

---

## 5) 프론트엔드(Vue.js)

### 5.1 프레임워크/언어

- **Vue 3 + TypeScript**
    
- 빌드: **Vite**
    
- 상태관리:
    
    - **Pinia**
        
- 라우팅:
    
    - vue-router
        

### 5.2 UI 컴포넌트/스타일

- UI 프레임워크(택1):
    
    - **Vuetify**(생산성↑) 또는 **Naive UI/Element Plus**
        
- CSS:
    
    - TailwindCSS(선택) 또는 SCSS
        
- 접근성:
    
    - aria 속성, 키보드 포커스, 숫자 색맹 고려
        

### 5.3 차트/데이터 시각화(핵심)

- 차트 라이브러리(권장):
    
    - **ECharts**(금융 차트/대규모 데이터에 강함)
        
    - 대안: TradingView Lightweight Charts(캔들/차트 특화)
        
- 표/그리드:
    
    - AG Grid Community(가능하면) 또는 vue-table 계열
        

### 5.4 API 통신

- HTTP Client:
    
    - Axios
        
- 인증 처리:
    
    - 인터셉터로 access token 자동 첨부
        
    - refresh token 재발급 로직
        

### 5.5 성능 최적화

- 차트 데이터 downsampling(일/주/월)
    
- 리스트 virtual scroll(포지션/거래내역)
    

---

## 6) 실시간 업데이트 방식(선택지 3개)

1. **폴링(기본/MVP)**
    

- 프론트가 `/valuation?mode=REALTIME`를 10~30초마다 호출
    
- 구현 쉬움, 서버 부하 예측 가능
    

2. **SSE(Server-Sent Events)**
    

- 단방향 스트림으로 valuation 업데이트 push
    
- WebSocket보다 단순
    

3. **WebSocket(STOMP)**
    

- 포트폴리오별 “구독” 모델 가능
    
- 사용자/포트가 많아지면 세션 관리 고려 필요
    

> MVP는 폴링 + Redis 캐시로 시작하고, 사용자 수 증가 시 SSE/WebSocket로 확장 추천.

---

## 7) DevOps/배포(권장 스택)

### 7.1 컨테이너/배포

- Docker + Docker Compose(개발)
    
- 운영:
    
    - Kubernetes(규모↑) 또는 ECS/VM(단순)
        
- Reverse Proxy:
    
    - Nginx (TLS 종료, 정적 파일 서빙)
        

### 7.2 CI/CD

- GitHub Actions
    
    - build/test
        
    - docker image push
        
    - deploy
        

### 7.3 환경 분리

- dev / stage / prod
    
- Spring profile로 분리
    
- secret: Vault/Parameter Store/KMS(운영)
    

---

## 8) 추천 라이브러리(도메인 특화)

### 8.1 금융 계산/수학

- IRR/최적화는 직접 구현 가능하나:
    
    - Apache Commons Math(기본 수치해석)
        
    - (백테스트 고도화 시) Smile/ojAlgo 검토
        

### 8.2 정밀 계산

- BigDecimal 기본
    
- 통화/라운딩 규칙:
    
    - 통화별 소수점 자리수(KRW 0, USD 2~4) 정책 테이블
        

---

## 9) 모듈/패키지 구조 제안(모놀리식 기준)

- `api` (Controller, DTO, OpenAPI)
    
- `auth` (Security, JWT)
    
- `portfolio` (Portfolio, Targets, Constraints)
    
- `ledger` (Transaction, Legs, Posting rules)
    
- `pricing` (Price/FX clients, cache)
    
- `valuation` (Valuation engine, snapshots)
    
- `analytics` (Performance, Risk, Compare)
    
- `backtest` (Configs, Runs, Worker interface)
    
- `infra` (Redis, MQ, DB, Observability)
    

---

## 10) “필수” 기술 선택 요약(너무 고민하지 말고 가는 조합)

- Backend: **Java 21 + Spring Boot 3.3 + Spring Security(JWT) + JPA + (집계는 jOOQ)**
    
- DB: **PostgreSQL 16 + Flyway**
    
- Cache: **Redis 7**
    
- MQ/Worker: **RabbitMQ + 별도 Spring Boot Worker**
    
- Front: **Vue 3 + TS + Vite + Pinia + ECharts**
    
- Docs/Obs: **Swagger(springdoc) + Actuator + Micrometer**
    
